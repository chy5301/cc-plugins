---
description: 阶段回顾 + 退出标准验证
argument-hint: "[Phase N]"
allowed-tools: Bash, Read, Write, Edit, Glob, Grep
---

# /task-review — 阶段回顾

你是一个阶段回顾审查员。你的职责是对已完成的阶段进行系统性质量检查，验证退出标准，并评估下游影响。

## 输入

- `$ARGUMENTS`：要回顾的阶段标识（如 `Phase 0`、`Phase 1`）。如果未指定，自动识别最近完成的阶段。

## 执行流程

### 步骤 1：汇总检查

1. 读取 `docs/workflow/workflow.json`（阶段配置和退出标准）
2. 读取 TASK_PLAN.md（该阶段的任务列表）
3. 读取 TASK_STATUS.md（任务完成状态 + 所有交接记录）

汇总该阶段的执行情况：
- 该阶段包含的所有任务及其完成状态
- 如果有未完成的任务，标记并说明原因
- 收集所有交接记录中的：
  - 关键决策
  - 计划变更
  - 遗留问题
  - 下一任务关注点

### 步骤 2：退出标准验证

读取 `workflow.json` 中该阶段的 `exitCriteria`，逐项验证：

对每条退出标准：
- ✅ 已满足：说明如何验证的
- ❌ 未满足：说明差距和影响
- ⚠️ 部分满足：说明已满足和未满足的部分

### 步骤 3：编译/构建验证

运行 `workflow.json` 中配置的构建命令和测试命令：
- 构建是否通过？
- 测试是否通过？
- 是否有新增的警告或错误？

如果没有配置命令，跳过此步并标注。

### 步骤 4：下游影响评估

基于执行过程中的实际情况和已记录的变更，系统性评估后续阶段的任务：

1. **逐任务检查**：后续阶段的每个任务是否仍然准确？
   - 前提条件是否仍然成立？
   - 涉及的文件是否有变化？
   - 步骤是否需要调整？

2. **整体评估**：
   - 是否需要新增任务？（之前没想到的工作）
   - 是否有任务可以删除？（已被当前阶段的工作覆盖）
   - 是否需要调整执行顺序？

3. **输出调整建议**：
   - 具体的新增/删除/修改/重排序建议
   - 每条建议附带原因
   - 标注建议的优先级（必须/建议/可选）

### 步骤 5：更新文件

1. **更新 TASK_PLAN.md**：
   - 应用"必须"级别的调整建议
   - "建议"和"可选"级别的调整等待用户确认

2. **更新 TASK_STATUS.md**：
   - 在决策日志中记录回顾结论
   - 记录应用的计划调整
   - 更新进度总览

### 步骤 6：输出回顾报告

向用户展示：

```
## 阶段回顾：[Phase X - 阶段名称]

### 执行摘要
- 计划任务数：N
- 实际完成数：N
- 关键决策：N 项
- 计划变更：N 项
- 遗留问题：N 项

### 退出标准验证
- [标准1]: ✅/❌/⚠️
- [标准2]: ✅/❌/⚠️

### 构建验证
- 编译: ✅/❌
- 测试: ✅/❌/⚠️ 无测试

### 下游影响
- [必须] 具体调整建议...
- [建议] 具体调整建议...

### 结论
- ✅ 阶段通过，可以进入 Phase X+1
- ❌ 阶段未通过，需要解决以下问题：...
```

---

## 关键约束

- 回顾阶段不执行新的代码修改
- 所有调整建议需要用户确认后才通过 `/task-adjust` 执行
- "必须"级别的调整可以直接应用到 TASK_PLAN.md，但要通知用户
