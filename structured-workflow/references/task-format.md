# 任务定义格式规范

本文档定义了结构化工作流中每个任务的标准格式。所有任务必须严格遵循此格式，以确保自包含性和可执行性。

---

## 任务模板

```markdown
### [<PREFIX>-XX] 动词-对象 标题

- **阶段**: Phase X - 阶段名称
- **依赖**: <PREFIX>-XX, <PREFIX>-XX（或"无"）
- **目标**: 一句话描述预期结果
- **背景信息**: 自包含上下文（清除记忆后仍可理解和执行）
- **涉及文件**: 具体文件/目录列表（≤ maxFilesPerTask）
- **具体步骤**:
  1. 步骤一
  2. 步骤二
  3. ...
- **验收标准**:
  - [ ] 可检查条件 1
  - [ ] 可检查条件 2
- **自测方法**: 验证命令 + 预期结果
- **回滚方案**: 如何撤销本次变更
- **预估工作量**: S (<30min) / M (30min-1.5h) / L (1.5-3h)
```

---

## 字段说明

### 任务编号 `[<PREFIX>-XX]`
- PREFIX 由 `workflow.json` 中的 `taskPrefix` 决定（如 R 表示重构，F 表示功能）
- 编号从 01 开始递增
- 子任务使用后缀：`<PREFIX>-XX-a`、`<PREFIX>-XX-b`

### 标题
- 采用"动词-对象"格式，简明描述任务内容
- 示例："提取-公共接口"、"迁移-数据模型"、"集成-认证模块"

### 阶段 (Phase)
- 标明任务所属的阶段
- 格式：`Phase X - 阶段名称`

### 依赖
- 列出必须在本任务之前完成的任务编号
- 如果没有依赖，标注"无"
- 循环依赖是不允许的

### 目标
- 一句话描述任务完成后的预期结果
- 必须具体、可验证
- 避免模糊描述如"优化代码""改善结构"

### 背景信息
- **最重要的字段**：提供执行此任务所需的全部上下文
- 假设读者完全不了解项目历史，仅凭此字段就能理解任务
- 包括：为什么要做、当前状态是什么、相关的设计决策
- 禁止使用"如前所述""参见上一任务"等引用

### 涉及文件
- 列出任务需要修改或新建的具体文件路径
- 文件数量不超过 `workflow.json` 中 `maxFilesPerTask` 的配置
- 如果超出上限，必须拆分任务

### 具体步骤
- 编号步骤列表
- 每步描述具体操作，而非抽象描述
- 步骤之间有明确的前后顺序

### 验收标准
- 使用 checkbox 格式
- 每条标准必须可客观检查（是/否）
- 覆盖功能正确性、编译通过、测试通过等维度

### 自测方法
- 提供具体的验证命令和预期输出
- 包括编译命令、测试命令、手动验证步骤

### 回滚方案
- 描述如何安全撤销本次变更
- 通常为 `git checkout -- <files>` 或具体的手动操作

### 预估工作量
- `S` (Small)：< 30 分钟
- `M` (Medium)：30 分钟 ~ 1.5 小时
- `L` (Large)：1.5 ~ 3 小时
- 超过 3 小时的任务**必须拆分**

---

## 质量检查清单

创建任务时，逐项检查：

- [ ] 标题是否为"动词-对象"格式？
- [ ] 背景信息是否自包含（不依赖外部上下文）？
- [ ] 涉及文件数量是否在约束范围内？
- [ ] 预估工作量是否在约束范围内？
- [ ] 验收标准是否可客观检查？
- [ ] 依赖关系是否正确声明？
- [ ] 回滚方案是否可行？

---

## 示例

```markdown
### [R-03] 提取-公共数据模型接口

- **阶段**: Phase 1 - 最小端到端
- **依赖**: R-01, R-02
- **目标**: 将 DataModel 的公共接口提取为独立头文件，供两个子系统共享
- **背景信息**: 当前项目有两个子系统（A 和 B）各自维护了一份 DataModel 实现。
  A 的 DataModel 位于 src/core/DataModel.h，使用信号槽机制通知 UI。
  B 的 DataModel 位于 modules/data/Model.h，使用回调函数模式。
  两者有 15 个字段重叠。本任务将重叠字段提取为公共接口 IDataModel，
  放置在 src/interfaces/ 目录下。
- **涉及文件**:
  - src/interfaces/IDataModel.h（新建）
  - src/core/DataModel.h（添加接口继承）
  - src/core/DataModel.cpp（适配接口）
- **具体步骤**:
  1. 分析 A 和 B 的 DataModel，列出重叠字段
  2. 创建 src/interfaces/IDataModel.h，定义纯虚接口
  3. 修改 src/core/DataModel.h 继承 IDataModel
  4. 更新 CMakeLists.txt 添加新文件
- **验收标准**:
  - [ ] IDataModel.h 包含所有重叠字段的 getter/setter 虚函数
  - [ ] DataModel 正确继承并实现 IDataModel
  - [ ] 项目编译通过，无新增警告
  - [ ] 现有功能不受影响
- **自测方法**: `cmake --build build` 编译通过，运行现有测试全部通过
- **回滚方案**: 删除 IDataModel.h，还原 DataModel.h/.cpp 的修改
- **预估工作量**: M (约 1 小时)
```
